<html>
	<head>
		<title>  GAME OF LIFE </title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<style>
	
	#MainTitle, #Instruction {
		pointer-events: none;
	}
	</style>
	</head>
	<body>
		<canvas id="myCanvas"></canvas> 
		<div id='MainTitle' style="position: absolute; z-index: 1;">GAME OF LIFE</div>
		<div id='Instruction' style="position: absolute; z-index: 1;"></div>
		

		<script>

		cellsidelength = 14;
		cellgap = 1;


		var c = document.getElementById("myCanvas");
		var ctx = c.getContext("2d");
		var title = document.getElementById("MainTitle")
		var inst = document.getElementById("Instruction")
		var opts = document.getElementById("Options")

		var canvaswidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
		var canvasheight = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;

		// Above Inner Window Size code from https://stackoverflow.com/a/28241682


		canvaswidth = canvaswidth - 30; 
		// To deal with the extra width from the window Innerwith function
		canvasheight = canvasheight - 30;
		ctx.canvas.width = canvaswidth;
		ctx.canvas.height = canvasheight;

		function DrawCell(X1,Y1,X2,Y2,fillColor) {
			ctx.fillStyle=fillColor;
			ctx.fillRect(X1,Y1,X2,Y2);
		}

		function DrawBorder() {
			ctx.lineWidth = '3px';
			ctx.rect(0,0,canvaswidth,canvasheight);
			ctx.stroke();
		}

		DrawBorder()

		var cells = {};
		var celldimensions = {};




		var start = 1;

		title.style.fontFamily = "Calibri";
		title.style.left = 0;
		title.style.top = 0;
		mainFontSize =Math.min(canvasheight,canvaswidth)/13;
		title.style.fontSize = mainFontSize;
		title.style.height = 0;
		title.style.textAlign = 'center';
		title.style.width = canvaswidth;
		title.style.wordSpacing = "18px";
		title.style.letterSpacing = '18px';

		inst.style.fontFamily = "Calibri";
		inst.style.left = 0;
		inst.style.top = 0;
		inst.style.width = canvaswidth;
		instFontSize = Math.min(canvasheight,canvaswidth)/30;
		inst.style.fontSize = instFontSize;
		inst.style.textAlign = 'center';
		inst.style.paddingTop = canvasheight /2;
		inst.style.height = 0;

		title.style.paddingTop = ((canvasheight /2) - mainFontSize - instFontSize);

			
		function DisplayTexts() {
			if(start == 1) {
				inst.innerHTML = "Click to place or remove seeds. <br/> Press spacebar to stop. <br/>";
			}
			if(start == 0) {
				inst.innerHTML = "Click to place or remove seeds. <br/> Press spacebar to start. <br/> Default Seeding is called 'Glider Gun'.";
			}
		}

		

		xcount = 0;
		for(xpos = cellgap; xpos < canvaswidth - cellsidelength; xpos = xpos + cellsidelength + cellgap) {
			ycount = 0;
			for(ypos = cellgap; ypos < canvasheight - cellsidelength; ypos = ypos + cellsidelength + cellgap) {
				cells[xcount.toString() + ',' + ycount.toString()] = 'Dead';
				celldimensions[xcount.toString() + ',' + ycount.toString()] = [xpos,ypos];
				//DrawCell(xpos, ypos, cellsidelength, cellsidelength, "rgba(131, 3, 251, 0.12)");
				ycount = ycount + 1;
			}
			xcount = xcount + 1;
		}

		function Seed(name) {
			if (name == 'glidergun') {
				liveCells = [[3, 5 ],[ 4, 5 ],[ 3, 6 ],[ 4, 6 ],[ 12, 5 ],[ 13, 5 ],[ 13, 6 ],[ 11, 6 ],[ 11, 7 ],[ 12, 7 ],[ 27, 3 ],[ 26, 5 ],[ 27, 4 ],[ 26, 3 ],[ 25, 5 ],[ 25, 4 ],[ 37, 3 ],[ 37, 4 ],[ 38, 4 ],[ 38, 3 ],[ 19, 7 ],[ 19, 8 ],[ 20, 7 ],[ 19, 9 ],[ 21, 8 ],[ 38, 10 ],[ 38, 11 ],[ 38, 12 ],[ 39, 10 ],[ 40, 11 ],[27, 15 ],[ 27, 16 ],[ 28, 15 ],[ 29, 15 ],[ 28, 17 ]]
			}
		 
			
			for (i = 0; i < liveCells.length; i++) {
				x = liveCells[i][0];
				y = liveCells[i][1];
				if (x < xcount && y < ycount) {
					cells[x.toString() + ',' + y.toString()] = 'Live';
					liveCellData[x.toString() + ',' + y.toString()] = 1;
				}
			}
		}


		function GetNeighboursStates(cellx,celly) {
			var neighbourdirectionval = [[1,0], [1,-1], [0,-1], [-1,-1], [-1,0], [-1,1], [0,1], [1,1]];
			var livelist = [];
			for (i = 0; i < 8; i ++) {
				try {
					Cellstate = cells[(cellx + neighbourdirectionval[i][0]).toString() + ',' + (celly + neighbourdirectionval[i][1]).toString()];
					if(Cellstate == 'Live') {
						livelist.push([cellx + neighbourdirectionval[i][0],celly + neighbourdirectionval[i][1]]);
					}
				}
				catch(err) {
					console.log(" Err ");
				}
			}

			return livelist;
			
		}


		function DrawCellwithLabel(X1,Y1,fillColor) {
			ctx.fillStyle = fillColor;
			X = (X1*(cellsidelength+cellgap)) + cellgap;
			Y = (Y1*(cellsidelength+cellgap)) + cellgap;
			if (X+cellsidelength < canvaswidth && Y+cellsidelength < canvasheight) {
				ctx.fillRect(X,Y,cellsidelength,cellsidelength);
			}
			ctx.fillRect(X,Y,cellsidelength,cellsidelength);
		}

		

		function DrawCells() {
			for (var key in cells) {
				if (cells.hasOwnProperty(key)) {
					if (cells[key] == 'Live') {
						liveX = parseInt(key.split(",")[0]);
						liveY = parseInt(key.split(",")[1]);
						//DrawCellwithLabel(liveX, liveY, 'rgba(255, 255, 255,1)')
						DrawCellwithLabel(liveX, liveY, 'orange')
					}
					if (cells[key] == 'Dead') {
						liveX = parseInt(key.split(",")[0]);
						liveY = parseInt(key.split(",")[1]);
						DrawCellwithLabel(liveX, liveY, 'rgba(255, 255, 255,1)')
						// Uncommenting the line below gives a color to the inactive cells.
						//DrawCellwithLabel(liveX, liveY, 'rgba(131, 3, 251, 0.12)')
					}

				}
			}
		}

		

		function KillorReproduce() {
			var tempcells = JSON.parse(JSON.stringify(cells));
			tempLiveCellData = JSON.parse(JSON.stringify(liveCellData));

			for (var key in tempLiveCellData) {
				if (tempLiveCellData.hasOwnProperty(key)) {
					currentliveX = parseInt(key.split(",")[0]);
					currentliveY = parseInt(key.split(",")[1]);

					keyX = currentliveX;
					keyY = currentliveY;

					livecells = GetNeighboursStates(keyX,keyY);

					if (livecells.length < 2 || livecells.length > 3) {
						tempcells[keyX.toString() + ',' + keyY.toString()] = 'Dead';
						delete liveCellData[key];
						DrawCellwithLabel(keyX, keyY, 'rgba(255, 255, 255,1)')
					}
					

					var neighbourdirections = [[1,0], [1,-1], [0,-1], [-1,-1], [-1,0], [-1,1], [0,1], [1,1]];
					for (nni = 0; nni < 8; nni ++) {
						
						try {
							checkcellX = currentliveX + neighbourdirections[nni][0];
							checkcellY = currentliveY + neighbourdirections[nni][1];
							keyX = checkcellX;
							keyY = checkcellY;
								
							if (cells[keyX.toString() + ',' + keyY.toString()] == 'Dead') {
								livecells = GetNeighboursStates(keyX,keyY);
								if (livecells.length == 3) {
									tempcells[keyX.toString() + ',' + keyY.toString()] = 'Live';
									liveCellData[keyX.toString() + ',' + keyY.toString()] = 1;
									//DrawCellwithLabel(keyX, keyY, 'rgba(255, 255, 255,1)')
									DrawCellwithLabel(keyX, keyY, 'orange')
								}
							}

						}
						catch(err) {
							console.log(" No Cell. ");

						}
					}
					
				}
			}

			cells = JSON.parse(JSON.stringify(tempcells));

		}


		liveCellData = {};
		Seed('glidergun');
		DrawCells();
		DisplayTexts();

		function clickResponse(event) {
			var rect = c.getBoundingClientRect();
			var posX = event.clientX - rect.left;
			var posY = event.clientY - rect.top;

			cX = parseInt((posX - (cellsidelength/5)) / (cellsidelength + cellgap));
			cY = parseInt((posY - (cellsidelength/5)) / (cellsidelength + cellgap));
			if (cX < xcount && cY < ycount  && cX >= 0 && cY >= 0) {
				if(cells[cX.toString() + ',' + cY.toString()] == 'Live') {
					cells[cX.toString() + ',' + cY.toString()] = 'Dead';
					delete liveCellData[cX.toString() + ',' + cY.toString()];
					DrawCellwithLabel(cX, cY, 'rgba(255, 255, 255,1)')
				}
				else {
					cells[cX.toString() + ',' + cY.toString()] = 'Live';
					liveCellData[cX.toString() + ',' + cY.toString()] = 1;
					DrawCellwithLabel(cX, cY, 'rgba(255, 255, 255,1)')
					DrawCellwithLabel(cX, cY, 'orange')
				}
			}
			
			
		}


		

		function keydownResponse(event) {
			if(event.keyCode == 32) {
				if(start == 1) {
					start = 0;
				}
				else {
					start = 1;
				}
			}
		}

		c.addEventListener('click', clickResponse);
		document.addEventListener('keydown',keydownResponse);

		Seed('glidergun');
		DrawCells();
		DisplayTexts();

		function Loop() {
			var id = setInterval(frame, 10);
			animationj = 0;
			function frame() {
				if (animationj < 0) {
					clearInterval(id);
				} 
				else {
					if (start == 1) {
						animationj = animationj + 1;
						KillorReproduce();
					}
					DisplayTexts();
				}
			}
		}

		Loop();

		</script>

		

	</body>
<html>
